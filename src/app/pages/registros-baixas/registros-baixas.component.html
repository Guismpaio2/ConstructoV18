<div class="main-content-container">
  <div class="page-header">
    <h1>Registros de Baixas</h1>
  </div>

  <div class="search-filter-bar mt-4">
    <div class="search-input">
      <i class="fas fa-search search-icon"></i>
      <input
        type="text"
        placeholder="Buscar por produto, usuário, motivo..."
        [(ngModel)]="searchTerm"
        (input)="triggerFilterAndSort()"
      />
    </div>

    <select
      [(ngModel)]="selectedProductFilter"
      (change)="triggerFilterAndSort()"
    >
      <option value="">Todos os Produtos</option>
      <option
        *ngFor="let productName of productNamesForFilter"
        [value]="productName"
      >
        {{ productName }}
      </option>
    </select>

    <select [(ngModel)]="selectedSort" (change)="triggerFilterAndSort()">
      <option value="dataBaixa_desc">Data da Baixa (Mais Recente)</option>
      <option value="dataBaixa_asc">Data da Baixa (Mais Antiga)</option>
      <option value="nomeProduto_asc">Nome do Produto (A-Z)</option>
      <option value="nomeProduto_desc">Nome do Produto (Z-A)</option>
      <option value="usuario_asc">Usuário (A-Z)</option>
      <option value="usuario_desc">Usuário (Z-A)</option>
    </select>
  </div>

  <div *ngIf="filteredBaixas.length === 0" class="alert alert-info mt-4">
    Nenhum registro de baixa encontrado.
  </div>

  <div *ngIf="filteredBaixas.length > 0" class="registros-baixas-table mt-4">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Nome do Produto</th>
            <th>Lote</th>
            <th>Quantidade Baixada</th>
            <th>Data da Baixa</th>
            <th>Motivo</th>
            <th>Usuário</th>
            <th>Observação</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let baixa of filteredBaixas">
            <td>{{ baixa.nomeProduto }}</td>
            <td>{{ baixa.lote }}</td>
            <td>{{ baixa.quantidadeBaixada }} un.</td>
            <td>{{ formatTimestamp(baixa.dataBaixa) }}</td>
            <td>{{ baixa.motivoBaixa }}</td>
            <td>{{ baixa.usuarioNome }}</td>
            <td>{{ baixa.observacao || "N/A" }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="main-content-container">
  <div class="page-header">
    <h1>Gerenciamento de Usuários</h1>
  </div>

  <div class="search-filter-bar">
    <div class="search-input">
      <i class="fas fa-search search-icon"></i>
      <input
        type="text"
        placeholder="Buscar por nome, email, código..."
        [(ngModel)]="searchTerm"
        (input)="triggerFilterAndSort()"
      />
    </div>

    <select [(ngModel)]="selectedRoleFilter" (change)="triggerFilterAndSort()">
      <option value="">Todas as Roles</option>
      <option value="Administrador">Administrador</option>
      <option value="Estoquista">Estoquista</option>
      <option value="Leitor">Leitor</option>
    </select>

    <select [(ngModel)]="selectedSort" (change)="triggerFilterAndSort()">
      <option value="nome_asc">Nome (A-Z)</option>
      <option value="nome_desc">Nome (Z-A)</option>
      <option value="role_asc">Role (A-Z)</option>
      <option value="role_desc">Role (Z-A)</option>
    </select>
  </div>

  <div *ngIf="filteredUsers.length === 0" class="alert alert-info">
    Nenhum usuário encontrado.
  </div>

  <div *ngIf="filteredUsers.length > 0" class="users-grid">
    <div class="user-card" *ngFor="let user of filteredUsers">
      <div class="profile-circle">
        <i class="fas fa-user"></i>
      </div>
      <h4>{{ user.nome }} {{ user.sobrenome }}</h4>
      <div class="user-info-detail">
        <div>
          <label>Email:</label>
          <span>{{ user.email }}</span>
        </div>
      </div>
      <div class="user-info-detail">
        <div>
          <label>Código:</label>
          <span>{{ user.employeeCode }}</span>
        </div>
      </div>
      <div class="user-info-detail role-select-group">
        <label for="role-{{ user.uid }}">Tipo de Permissão:</label>
        <select
          id="role-{{ user.uid }}"
          [(ngModel)]="user.role"
          (change)="onRoleChange(user)"
          [disabled]="user.uid === currentUserId"
        >
          <option value="Administrador">Administrador</option>
          <option value="Estoquista">Estoquista</option>
          <option value="Leitor">Leitor</option>
        </select>
      </div>
      <div class="user-info-detail">
        <div>
          <label>Data de Cadastro:</label>
          <span>{{ formatTimestamp(user.dataCadastro) }}</span>
        </div>
      </div>
      <div class="user-info-detail">
        <div>
          <label>Último Login:</label>
          <span>{{ formatTimestamp(user.lastLogin) }}</span>
        </div>
      </div>
      <button
        *ngIf="user.uid !== currentUserId"
        class="btn-delete-user"
        (click)="onDeleteUser(user.uid, user.nome)"
      >
        <i class="fas fa-trash-alt"></i> Excluir Usuário
      </button>
    </div>
  </div>
</div>

<div class="main-content-container">
  <div class="page-header">
    <h1>Gerenciamento de Produtos</h1>
    <button
      *ngIf="canAddEditDelete"
      class="btn btn-primary"
      (click)="goToAddProduct()"
    >
      <i class="fas fa-plus"></i> Adicionar Produto
    </button>
  </div>

  <div class="search-filter-bar mt-4">
    <div class="search-input">
      <i class="fas fa-search search-icon"></i>
      <input
        type="text"
        placeholder="Buscar por nome, descrição, marca, tipo..."
        [(ngModel)]="searchTerm"
        (input)="triggerFilterAndSort()"
      />
    </div>

    <select [(ngModel)]="selectedTypeFilter" (change)="triggerFilterAndSort()">
      <option value="">Todos os Tipos</option>
      <option value="Elétrico">Elétrico</option>
      <option value="Hidráulico">Hidráulico</option>
      <option value="Alvenaria">Alvenaria</option>
      <option value="Madeira">Madeira</option>
      <option value="Ferramenta">Ferramenta</option>
    </select>

    <select [(ngModel)]="selectedSort" (change)="triggerFilterAndSort()">
      <option value="nome_asc">Nome (A-Z)</option>
      <option value="nome_desc">Nome (Z-A)</option>
      <option value="tipo_asc">Tipo (A-Z)</option>
      <option value="tipo_desc">Tipo (Z-A)</option>
      <option value="marca_asc">Marca (A-Z)</option>
      <option value="marca_desc">Marca (Z-A)</option>
    </select>
  </div>

  <div *ngIf="filteredProducts.length === 0" class="alert alert-info mt-4">
    Nenhum produto encontrado.
  </div>

  <div *ngIf="filteredProducts.length > 0" class="products-grid mt-4">
    <div class="product-card" *ngFor="let product of filteredProducts">
      <h4>{{ product.nome }}</h4>
      <p class="description">{{ product.descricao }}</p>
      <div class="product-details">
        <span><label>Tipo:</label> {{ product.tipo }}</span>
        <span><label>Marca:</label> {{ product.marca }}</span>
        <span><label>Unidade:</label> {{ product.unidadeMedida }}</span>
      </div>
      <div class="product-dates">
        <small
          ><label>Cadastrado em:</label>
          {{ formatTimestamp(product.dataCadastro) }}</small
        >
        <small *ngIf="product.dataUltimaEdicao"
          ><label>Última Edição:</label>
          {{ formatTimestamp(product.dataUltimaEdicao) }}</small
        >
        <small *ngIf="product.usuarioUltimaEdicaoNome"
          ><label>Por:</label> {{ product.usuarioUltimaEdicaoNome }}</small
        >
      </div>

      <div class="product-actions" *ngIf="canAddEditDelete">
        <button
          class="btn btn-sm btn-outline-info"
          (click)="goToEditProduct(product.uid)"
        >
          <i class="fas fa-edit"></i> Editar
        </button>
        <button
          class="btn btn-sm btn-outline-danger"
          (click)="onDeleteProduct(product.uid, product.nome)"
        >
          <i class="fas fa-trash-alt"></i> Excluir
        </button>
      </div>
    </div>
  </div>
</div>
